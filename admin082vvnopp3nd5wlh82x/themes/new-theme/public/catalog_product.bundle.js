(()=>{"use strict";
/**
 * Copyright since 2007 PrestaShop SA and Contributors
 * PrestaShop is an International Registered Trademark & Property of PrestaShop SA
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/OSL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to https://devdocs.prestashop.com/ for more information.
 *
 * @author    PrestaShop SA and Contributors <contact@prestashop.com>
 * @copyright Since 2007 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)
 */const e="#js-specific-price-list",i="#specific_price_form .js-cancel",t="#specific_price_form",c="#specific_price_form .js-save",r="#js-open-create-specific-price-form",s=e=>`${e}leave_bprice`,o=e=>`${e}sp_reduction_type`,a="#form_modal_cancel",d="#form_modal_cancel",l="#form_modal_save",{$:n}=window;const p=class{constructor(){this.prefixCreateForm="form_step2_specific_price_",this.prefixEditForm="form_modal_",this.editModalIsOpen=!1,this.$createPriceFormDefaultValues={},this.storePriceFormDefaultValues(),this.loadAndDisplayExistingSpecificPricesList(),this.configureAddPriceFormBehavior(),this.configureEditPriceModalBehavior(),this.configureDeletePriceButtonsBehavior(),this.configureMultipleModalsBehavior()}loadAndDisplayExistingSpecificPricesList(){const i=n(e),t=i.data("listingUrl").replace(/list\/\d+/,`list/${this.getProductId()}`);n.ajax({type:"GET",url:t}).done((e=>{const t=i.find("tbody");t.find("tr").remove(),e.length>0?i.removeClass("hide"):i.addClass("hide");const c=this.renderSpecificPricesListingAsHtml(e);t.append(c)}))}renderSpecificPricesListingAsHtml(e){let i="";const t=n("#js-specific-price-list"),c=this;return n.each(e,((e,r)=>{const s=t.attr("data-action-delete");let o;if(s){const e=s.replace(/delete\/\d+/,`delete/${r.id_specific_price}`);o=c.renderSpecificPriceRow(r,e)}i+=o})),i}renderSpecificPriceRow(e,i){const t=e.id_specific_price,c=e.can_delete?`<a href="${i}" class="js-delete delete btn tooltip-link delete pl-0 pr-0"><i class="material-icons">delete</i></a>`:"",r=e.can_edit?`<a href="#" data-specific-price-id="${t}" class="js-edit edit btn tooltip-link delete pl-0 pr-0"><i class="material-icons">edit</i></a>`:"";return`<tr>     <td>${e.id_specific_price}</td>     <td>${e.rule_name}</td>     <td>${e.attributes_name}</td>     <td>${e.currency}</td>     <td>${e.country}</td>     <td>${e.group}</td>     <td>${e.customer}</td>     <td>${e.fixed_price}</td>     <td>${e.impact}</td>     <td>${e.period}</td>     <td>${e.from_quantity}</td>     <td>${c}</td>     <td>${r}</td></tr>`}configureAddPriceFormBehavior(){const e=!0,a=this.getPrefixSelector(e);n(i).on("click",(()=>{this.resetCreatePriceFormDefaultValues(),n(t).collapse("hide")})),n(c).on("click",(()=>this.submitCreatePriceForm())),n(r).on("click",(()=>this.loadAndFillOptionsForSelectCombinationInput(e))),n(s(a)).on("click",(()=>this.enableSpecificPriceFieldIfEligible(e))),n(o(a)).on("change",(()=>this.enableSpecificPriceTaxFieldIfEligible(e)))}configureEditPriceFormInsideModalBehavior(){const e=!1,i=this.getPrefixSelector(e);n(a).on("click",(()=>this.closeEditPriceModalAndRemoveForm())),n(d).on("click",(()=>this.closeEditPriceModalAndRemoveForm())),n(l).on("click",(()=>this.submitEditPriceForm())),this.loadAndFillOptionsForSelectCombinationInput(e),n(s(i)).on("click",(()=>this.enableSpecificPriceFieldIfEligible(e))),n(o).on("change",(()=>this.enableSpecificPriceTaxFieldIfEligible(e))),this.reinitializeDatePickers(),this.initializeLeaveBPriceField(e),this.enableSpecificPriceTaxFieldIfEligible(e)}reinitializeDatePickers(){n(".datepicker input").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",sideBySide:!0,icons:{time:"time",date:"date",up:"up",down:"down"}})}initializeLeaveBPriceField(e){const i=this.getPrefixSelector(e);""!==n(`${i}sp_price`).val()&&(n(`${i}sp_price`).prop("disabled",!1),n(`${i}leave_bprice`).prop("checked",!1))}configureEditPriceModalBehavior(){n(document).on("click","#js-specific-price-list .js-edit",(e=>{e.preventDefault();const i=n(e.currentTarget).data("specificPriceId");this.openEditPriceModalAndLoadForm(i)}))}configureDeletePriceButtonsBehavior(){n(document).on("click","#js-specific-price-list .js-delete",(e=>{e.preventDefault(),this.deleteSpecificPrice(e.currentTarget)}))}configureMultipleModalsBehavior(){n(".modal").on("hidden.bs.modal",(()=>{this.editModalIsOpen&&n("body").addClass("modal-open")}))}submitCreatePriceForm(){const e=n("#specific_price_form").attr("data-action"),i=n("#specific_price_form input, #specific_price_form select, #form_id_product").serialize();n("#specific_price_form .js-save").attr("disabled","disabled"),n.ajax({type:"POST",url:e,data:i}).done((()=>{window.showSuccessMessage(window.translate_javascripts["Form update success"]),this.resetCreatePriceFormDefaultValues(),n("#specific_price_form").collapse("hide"),this.loadAndDisplayExistingSpecificPricesList(),n("#specific_price_form .js-save").removeAttr("disabled")})).fail((e=>{window.showErrorMessage(e.responseJSON),n("#specific_price_form .js-save").removeAttr("disabled")}))}submitEditPriceForm(){const e=n("#edit-specific-price-modal-form").attr("data-action"),i=n("#edit-specific-price-modal-form").data("specificPriceId"),t=e.replace(/update\/\d+/,`update/${i}`),c=n("#edit-specific-price-modal-form input, #edit-specific-price-modal-form select, #form_id_product").serialize();n("#edit-specific-price-modal-form .js-save").attr("disabled","disabled"),n.ajax({type:"POST",url:t,data:c}).done((()=>{window.showSuccessMessage(window.translate_javascripts["Form update success"]),this.closeEditPriceModalAndRemoveForm(),this.loadAndDisplayExistingSpecificPricesList(),n("#edit-specific-price-modal-form .js-save").removeAttr("disabled")})).fail((e=>{window.showErrorMessage(e.responseJSON),n("#edit-specific-price-modal-form .js-save").removeAttr("disabled")}))}deleteSpecificPrice(e){window.modalConfirmation.create(window.translate_javascripts["Are you sure you want to delete this item?"],null,{onContinue:()=>{const i=n(e).attr("href");n(e).attr("disabled","disabled"),n.ajax({type:"GET",url:i}).done((i=>{this.loadAndDisplayExistingSpecificPricesList(),window.showSuccessMessage(i),n(e).removeAttr("disabled")})).fail((i=>{window.showErrorMessage(i.responseJSON),n(e).removeAttr("disabled")}))}}).show()}storePriceFormDefaultValues(){const e=this.$createPriceFormDefaultValues;n("#specific_price_form").find("select,input").each(((i,t)=>{e[n(t).attr("id")]=n(t).val()})),n("#specific_price_form").find("input:checkbox").each(((i,t)=>{e[n(t).attr("id")]=n(t).prop("checked")})),this.$createPriceFormDefaultValues=e}loadAndFillOptionsForSelectCombinationInput(e){const i=this.getPrefixSelector(e),t=n(`${i}sp_id_product_attribute`),c=t.attr("data-action").replace(/product-combinations\/\d+/,`product-combinations/${this.getProductId()}`);n.ajax({type:"GET",url:c}).done((e=>{t.find("option:gt(0)").remove(),n.each(e,((e,i)=>{t.append(`<option value="${i.id}">${i.name}</option>`)})),"0"!==t.data("selectedAttribute")&&t.val(t.data("selectedAttribute")).trigger("change")}))}enableSpecificPriceTaxFieldIfEligible(e){const i=this.getPrefixSelector(e);"percentage"===n(`${i}sp_reduction_type`).val()?n(`${i}sp_reduction_tax`).hide():n(`${i}sp_reduction_tax`).show()}resetCreatePriceFormDefaultValues(){const e=this.$createPriceFormDefaultValues;n("#specific_price_form").find("input").each(((i,t)=>{n(t).val(e[n(t).attr("id")])})),n("#specific_price_form").find("select").each(((i,t)=>{n(t).val(e[n(t).attr("id")]).change()})),n("#specific_price_form").find("input:checkbox").each(((e,i)=>{n(i).prop("checked",!0)}))}enableSpecificPriceFieldIfEligible(e){const i=this.getPrefixSelector(e);n(`${i}sp_price`).prop("disabled",n(`${i}leave_bprice`).is(":checked")).val("")}openEditPriceModalAndLoadForm(e){const i=n("#js-specific-price-list").data("actionEdit").replace(/form\/\d+/,`form/${e}`);n("#edit-specific-price-modal").modal("show"),this.editModalIsOpen=!0,n.ajax({type:"GET",url:i}).done((i=>{this.insertEditSpecificPriceFormIntoModal(i),n("#edit-specific-price-modal-form").data("specificPriceId",e),this.configureEditPriceFormInsideModalBehavior()})).fail((e=>{window.showErrorMessage(e.responseJSON)}))}closeEditPriceModalAndRemoveForm(){n("#edit-specific-price-modal").modal("hide"),this.editModalIsOpen=!1;n("#edit-specific-price-modal-form").empty()}insertEditSpecificPriceFormIntoModal(e){const i=n("#edit-specific-price-modal-form");i.empty(),i.append(e)}getProductId(){return n("#form_id_product").val()}getPrefixSelector(e){return e?`#${this.prefixCreateForm}`:`#${this.prefixEditForm}`}},{$:f}=window;f((()=>{new p})),window.catalog_product={}})();